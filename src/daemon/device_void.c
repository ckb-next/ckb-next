#include "command.h"
#include "device.h"
#include "devnode.h"
#include "firmware.h"
#include "input.h"
#include "profile.h"
#include "usb.h"

int cmd_active_void(usbdevice* kb, usbmode* dummy1, int dummy2, int dummy3, const char* dummy4){
    (void)dummy1;
    (void)dummy2;
    (void)dummy3;
    (void)dummy4;
    
    queued_mutex_lock(imutex(kb));

    if(kb->active)
        return 0;

    uchar init1[3] =
        { 0xc8, 0x01, 0x00 };

    uchar init2[2][20] = {
        { 0xcb, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
        { 0xcb, 0x09, 0x2c, 0xaf, 0x26, 0xaf, 0x27, 0xaf, 0x2d, 0xaf, 0x28, 0xaf, 0x29, 0xaf, 0x2e, 0x56, 0x2b, 0x56, 0x2a, 0x56 }
    };

    uchar init3[5] =
        { 0xca, 0x04, 0x01, 0xf0, 0x3f };

    uchar init4[3] =
        { 0xc8, 0x00, 0x00 };

    uchar init5[20] = 
        { 0xcb, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };

    uchar init6[2] = 
        { 0xc9, 0x66 };

    uchar init7[3] =
        { 0xc8, 0x01, 0x8c };

    uchar init8[20] = 
        { 0xcb, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };

    uchar init9[5] =
        { 0xca, 0x04, 0x00, 0x00, 0x30 };

    uchar init10[20] = 
        { 0xcb, 0x08, 0x0c, 0x20, 0x06, 0x20, 0x07, 0x20, 0x0d, 0x20, 0x08, 0x20, 0x09, 0x20, 0x0b, 0x20, 0x0a, 0x20, 0x00, 0x00 };

    uchar init11[5] =
        { 0xca, 0x04, 0x01, 0x00, 0x00 };

    uchar init12[20] =
        { 0xcb, 0x09, 0x2c, 0xaf, 0x26, 0xaf, 0x27, 0xaf, 0x2d, 0xaf, 0x28, 0xaf, 0x29, 0xaf, 0x2e, 0x56, 0x2b, 0x56, 0x2a, 0x56 };

    uchar init13[2] =
        { 0xc9, 0x66 };

    uchar init14[14][20] = {
        { 0xcb, 0x09, 0x2c, 0xaf, 0x26, 0xaf, 0x27, 0xaf, 0x2d, 0xaf, 0x28, 0xaf, 0x29, 0xaf, 0x2e, 0xaf, 0x2b, 0xaf, 0x2a, 0xaf },
        { 0xcb, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
        { 0xcb, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
        { 0xcb, 0x01, 0x01, 0x15, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
        { 0xcb, 0x09, 0x1c, 0x00, 0x16, 0x00, 0x17, 0x00, 0x1d, 0x00, 0x18, 0x00, 0x19, 0x00, 0x1b, 0x00, 0x1a, 0x00, 0x1e, 0x00 },
        { 0xcb, 0x09, 0x4f, 0x00, 0x50, 0x9c, 0x51, 0x18, 0x52, 0x40, 0x53, 0x00, 0x54, 0x46, 0x55, 0x00, 0x56, 0x40, 0x57, 0x00 },
        { 0xcb, 0x09, 0x58, 0x7e, 0x59, 0x00, 0x5a, 0x42, 0x5b, 0x00, 0x5c, 0xe3, 0x5d, 0x0c, 0x5e, 0xa0, 0x5f, 0x01, 0x60, 0x9c },
        { 0xcb, 0x09, 0x61, 0x19, 0x62, 0x40, 0x63, 0x00, 0x64, 0x46, 0x65, 0x00, 0x66, 0x40, 0x67, 0x00, 0x68, 0x7e, 0x69, 0x00 },
        { 0xcb, 0x09, 0x6a, 0x42, 0x6b, 0x00, 0x6c, 0xe2, 0x6d, 0x8a, 0x6e, 0xa0, 0x6f, 0x01, 0x4f, 0x01, 0x50, 0x9c, 0x51, 0x1a },
        { 0xcb, 0x09, 0x52, 0x40, 0x53, 0xaf, 0x54, 0x46, 0x55, 0x00, 0x56, 0x40, 0x57, 0x00, 0x58, 0x7e, 0x59, 0x00, 0x5a, 0x42 },
        { 0xcb, 0x09, 0x5b, 0x00, 0x5c, 0xe1, 0x5d, 0x86, 0x5e, 0xa0, 0x5f, 0x01, 0x60, 0x00, 0x61, 0xc0, 0x62, 0x00, 0x63, 0x05 },
        { 0xcb, 0x02, 0x64, 0x00, 0x65, 0x0a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
        { 0xcb, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
        { 0xcb, 0x05, 0x4c, 0x00, 0x4d, 0x08, 0x4e, 0x10, 0x01, 0x2a, 0x00, 0x6a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }
    };

    uchar init15[2] =
        { 0xc9, 0x66 };

    uchar init16[2][20] = {
        { 0xcb, 0x03, 0x1e, 0x00, 0x1b, 0xff, 0x1a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
        { 0xcb, 0x03, 0x1e, 0x00, 0x1b, 0x00, 0x1a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 }
    };

    uchar init17[2] =
        { 0xc9, 0x66 };

    if(!usbsend(kb, init1, 1))
        return -1;

    if(!usbsend(kb, init2[0], 2))
        return -1;

    if(!usbsend(kb, init3, 1))
        return -1;

    if(!usbsend(kb, init4, 1))
        return -1;

    if(!usbsend(kb, init5, 1))
        return -1;

    if(!usbsend(kb, init6, 1))
        return -1;

    if(!usbsend(kb, init7, 1))
        return -1;

    if(!usbsend(kb, init8, 1))
        return -1;

    if(!usbsend(kb, init9, 1))
        return -1;

    if(!usbsend(kb, init10, 1))
        return -1;

    if(!usbsend(kb, init11, 1))
        return -1;

    if(!usbsend(kb, init12, 1))
        return -1;

    if(!usbsend(kb, init13, 1))
        return -1;

    if(!usbsend(kb, init14[0], 14))
        return -1;

    if(!usbsend(kb, init15, 1))
        return -1;

    if(!usbsend(kb, init16[0], 2))
        return -1;

    if(!usbsend(kb, init17, 1))
        return -1;


    kb->active = 1;

    queued_mutex_unlock(imutex(kb));
    
    return 0;
}

int cmd_idle_void(usbdevice* kb, usbmode* dummy1, int dummy2, int dummy3, const char* dummy4){
    (void)dummy1;
    (void)dummy2;
    (void)dummy3;
    (void)dummy4;

    if(!kb->active)
        return 0;

    uchar deinit1[2][20] = {
        { 0xcb, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
        { 0xcb, 0x09, 0x2c, 0xaf, 0x26, 0xaf, 0x27, 0xaf, 0x2d, 0xaf, 0x28, 0xaf, 0x29, 0xaf, 0x2e, 0x56, 0x2b, 0x56, 0x2a, 0x56 },
    };

    uchar deinit2[5] =
        { 0xca, 0x04, 0x01, 0xaa, 0x14 };

    uchar deinit3[3] =
        { 0xc8, 0x00, 0x00 };

    uchar deinit4[20] =
        { 0xcb, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 };

    if(!usbsend(kb, deinit1[0], 2))
        return -1;

    if(!usbsend(kb, deinit2, 1))
        return -1;

    if(!usbsend(kb, deinit3, 1))
        return -1;

    if(!usbsend(kb, deinit4, 1))
        return -1;

    kb->active = 0;

    return 0;
}
